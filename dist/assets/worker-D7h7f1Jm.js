(function(){"use strict";console.log("worker created");let x,I=!0;const M=7,E=2,F=3,P=6.6743,L=1;function O(n,l,a){let r=0,t=0;for(let s=0;s+M-1<a.length;s+=M){const o=a[s]??0,d=a[s+1]??0;a[s+2];const u=a[s+6]??0;if(!Number.isFinite(o)||!Number.isFinite(d)||!Number.isFinite(u)||u===0)continue;const m=o-n,f=d-l,h=Math.max(m*m+f*f,L);if(!Number.isFinite(h)||h===0)continue;const w=P*u/h,D=1/Math.sqrt(h);r+=w*m*D,t+=w*f*D}return[r,t]}let e,c,A,N,i,S,p,g;onmessage=n=>{n.data?.type===1?(I?I=!1:V(x.data.ActivePixelBuffer),x=n,postMessage({id:F,worker_id:N})):n.data?.id>=0&&(T(n),postMessage({id:E,worker_id:N}))};const T=n=>{const{id:l,ParticleBuffer:a,SimulationData:r,GravityBuffer:t,ParticleOffsetStart:s,ParticleOffsetEnd:o,FIELDS:d}=n.data;e=a,c=r,A=t,N=l,S=s,p=o,i=d,g=[c[1],c[2],c[3],c[4],c[5]]},V=n=>{const l=g[3]??1920,a=g[4]??1080,r=c[0];for(let t=S;t<p;t++){let s=e[t*i],o=e[t*i+1],d=e[t*i+3],u=e[t*i+4];if(e[t*i]=s+d*r,e[t*i+1]=o+u*r,A.length>0){const f=O(e[t*i],e[t*i+1],A);e[t*i+3]+=f[0],e[t*i+4]+=f[1]}(s<0||s>=l||o<0||o>=a)&&(e[t*i]=Math.random()*l,e[t*i+1]=Math.random()*a,e[t*i+3]=(Math.random()*2-1)*100,e[t*i+4]=(Math.random()*2-1)*100);const m=(s|0)+(o|0)*l;n[m]++}}})();
